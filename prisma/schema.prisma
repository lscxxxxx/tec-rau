// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

// Bloco de configuração do banco de dados e do gerador do client
datasource db {
  provider          = "postgresql"
  url               = env("DATABASE_URL")
  shadowDatabaseUrl = env("SHADOW_DATABASE_URL")
}

generator client {
  provider = "prisma-client-js"
  seed = "ts-node prisma/seed.ts"
}

generator erd {
  provider = "prisma-erd-generator"
  output   = "./ERD.png"
  theme    = "dark"
}

enum PapelAdmin {
  SUPER
  PADRAO
}

enum PapelPessoa {
  AUTOR
  ORIENTADOR
  COORIENTADOR
}

enum AcaoAuditoria {
  CREATE
  UPDATE
  DELETE
}

model Admin {
  id    Int        @id @default(autoincrement())
  nome  String     @unique
  email String     @unique
  senha String  
  papel PapelAdmin

  auditorias Auditoria[]
}

model Auditoria {
  id              Int           @id @default(autoincrement())
  dataModificacao DateTime      @default(now())
  acao            AcaoAuditoria
  log             String

  admin_id    Int
  trabalho_id Int

  admin    Admin    @relation(fields: [admin_id], references: [id])
  trabalho Trabalho @relation(fields: [trabalho_id], references: [id])
}

model Curso {
  id        Int        @id @default(autoincrement())
  nome      String     @unique
  trabalhos Trabalho[]
}

model TipoDocumental {
  id        Int        @id @default(autoincrement())
  nome      String     @unique
  trabalhos Trabalho[]
}

model Trabalho {
  id             Int      @id @default(autoincrement())
  titulo         String   @unique
  dataPublicacao DateTime @default(now())
  dataDefesa     DateTime
  resumo         String
  arquivo        String

  curso_id          Int
  tipodocumental_id Int

  curso          Curso          @relation(fields: [curso_id], references: [id])
  tipoDocumental TipoDocumental @relation(fields: [tipodocumental_id], references: [id])

  audiorias     Auditoria[]
  pessoas       TrabalhoPessoa[]
  palavrasChave TrabalhoPalavraChave[]
}

model Pessoa {
  id        Int    @id @default(autoincrement())
  nome      String
  sobrenome String

  trabalhos TrabalhoPessoa[]

  @@unique([nome, sobrenome], name: "nome_sobrenome")
}

model PalavraChave {
  id   Int    @id @default(autoincrement())
  nome String @unique

  trabalhos TrabalhoPalavraChave[]
}

model TrabalhoPessoa {
  trabalho_id Int
  pessoa_id   Int
  papel       PapelPessoa

  trabalho Trabalho @relation(fields: [trabalho_id], references: [id])
  pessoa   Pessoa   @relation(fields: [pessoa_id], references: [id])

  @@id([trabalho_id, pessoa_id])
}

model TrabalhoPalavraChave {
  trabalho_id     Int
  palavrachave_id Int

  trabalho     Trabalho     @relation(fields: [trabalho_id], references: [id])
  palavraChave PalavraChave @relation(fields: [palavrachave_id], references: [id])

  @@id([trabalho_id, palavrachave_id])
}